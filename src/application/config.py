from dataclasses import dataclass, field
from typing import Dict, List

from src.core.entities import Word


@dataclass(frozen=True)
class GameConfig:
    """Неизменяемая конфигурация игры."""

    categories: Dict[str, Dict[str, List[Word]]] = field(default_factory=dict)
    level_attempts: Dict[str, int] = field(default_factory=dict)
    hints: Dict[str, str] = field(default_factory=dict)

    def __post_init__(self):
        if not self.categories:
            object.__setattr__(
                self,
                "categories",
                {
                    "животные": {
                        "лёгкий": [
                            Word("кот", "маленькое домашнее животное"),
                            Word("собака", "верный друг человека"),
                            Word("мышь", "маленький грызун"),
                        ],
                        "средний": [
                            Word("слон", "крупное животное с хоботом"),
                            Word("жираф", "высокое животное с длинной шеей"),
                            Word("лев", "царь зверей"),
                        ],
                        "сложный": [
                            Word("гиппопотам", "крупное водное млекопитающее"),
                            Word("крокодил", "хищная рептилия"),
                            Word("носорог", "животное с рогом"),
                        ],
                    },
                    "фрукты": {
                        "лёгкий": [
                            Word("яблоко", "красный или зелёный фрукт"),
                            Word("банан", "жёлтый изогнутый фрукт"),
                            Word("вишня", "маленькая красная ягода"),
                        ],
                        "средний": [
                            Word("апельсин", "цитрусовый фрукт"),
                            Word("манго", "тропический фрукт"),
                            Word("киви", "фрукт с зелёной мякотью"),
                        ],
                        "сложный": [
                            Word("ананас", "фрукт с колючей кожурой"),
                            Word("грейпфрут", "кислый цитрусовый"),
                            Word("папайя", "тропический фрукт с семенами"),
                        ],
                    },
                    "страны": {
                        "лёгкий": [
                            Word("россия", "самая большая страна"),
                            Word("сша", "страна с 50 штатами"),
                            Word("китай", "страна с Великой стеной"),
                        ],
                        "средний": [
                            Word("германия", "страна пива и сосисок"),
                            Word("франция", "страна Эйфелевой башни"),
                            Word("япония", "страна самураев"),
                        ],
                        "сложный": [
                            Word("австралия", "континент-страна"),
                            Word("аргентина", "страна танго"),
                            Word("индонезия", "страна островов"),
                        ],
                    },
                },
            )
        if not self.level_attempts:
            object.__setattr__(
                self, "level_attempts", {"лёгкий": 7, "средний": 6, "сложный": 4}
            )
        if not self.hints:
            object.__setattr__(
                self,
                "hints",
                {
                    "кот": "маленькое домашнее животное",
                    "собака": "верный друг человека",
                    "мышь": "маленький грызун",
                    "слон": "крупное животное с хоботом",
                    "жираф": "высокое животное с длинной шеей",
                    "лев": "царь зверей",
                    "гиппопотам": "крупное водное млекопитающее",
                    "крокодил": "хищная рептилия",
                    "носорог": "животное с рогом",
                    "яблоко": "красный или зелёный фрукт",
                    "банан": "жёлтый изогнутый фрукт",
                    "вишня": "маленькая красная ягода",
                    "апельсин": "цитрусовый фрукт",
                    "манго": "тропический фрукт",
                    "киви": "фрукт с зелёной мякотью",
                    "ананас": "фрукт с колючей кожурой",
                    "грейпфрут": "кислый цитрусовый",
                    "папайя": "тропический фрукт с семенами",
                    "россия": "самая большая страна",
                    "сша": "страна с 50 штатами",
                    "китай": "страна с Великой стеной",
                    "германия": "страна пива и сосисок",
                    "франция": "страна Эйфелевой башни",
                    "япония": "страна самураев",
                    "австралия": "континент-страна",
                    "аргентина": "страна танго",
                    "индонезия": "страна островов",
                },
            )

    def level_descriptions(self) -> Dict[str, str]:
        """Получить описания уровней."""
        return {
            lvl: f"({self.pluralize_attempts(self.level_attempts[lvl])})"
            for lvl in self.level_attempts
        }

    @staticmethod
    def pluralize_attempts(count: int) -> str:
        """Склонение числа попыток на русском."""
        if count % 10 == 1 and count % 100 != 11:
            return f"{count} попытка"
        elif 2 <= count % 10 <= 4 and (count % 100 < 10 or count % 100 >= 20):
            return f"{count} попытки"
        else:
            return f"{count} попыток"
